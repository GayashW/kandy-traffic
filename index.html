<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kandy Virtual Floating Car Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background-color: #0f172a; }
  </style>
</head>
<body class="text-slate-200 p-4">

  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">ðŸš— Kandy Virtual Floating Car Monitor</h1>

    <!-- CONFIG -->
    <script>
      const CONFIG = {
        GITHUB_USER: "YOUR_GITHUB_USERNAME",
        REPO: "YOUR_REPO_NAME",
        GITHUB_TOKEN: "YOUR_GITHUB_TOKEN"
      };
    </script>

    <!-- Trigger Button -->
    <div class="mb-4">
      <button id="triggerBtn"
        class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded">
        Trigger Scrape
      </button>
      <span id="status" class="ml-4 text-sm text-slate-400"></span>
    </div>

    <!-- Data Table -->
    <div class="overflow-x-auto">
      <table class="w-full text-sm border border-slate-700">
        <thead class="bg-slate-800">
          <tr>
            <th class="p-2">Timestamp (UTC)</th>
            <th class="p-2">Origin</th>
            <th class="p-2">Destination</th>
            <th class="p-2">ETA (min)</th>
            <th class="p-2">Distance (km)</th>
            <th class="p-2">Speed (km/h)</th>
            <th class="p-2">Proc Time (s)</th>
          </tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function triggerWorkflow() {
      document.getElementById("status").textContent = "Triggering workflow...";
      const res = await fetch(
        `https://api.github.com/repos/${CONFIG.GITHUB_USER}/${CONFIG.REPO}/dispatches`,
        {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${CONFIG.GITHUB_TOKEN}`,
            "Accept": "application/vnd.github+json",
          },
          body: JSON.stringify({ event_type: "manual-trigger" }),
        }
      );

      document.getElementById("status").textContent =
        res.status === 204 ? "Triggered successfully." : "Trigger failed.";
    }

    async function loadCSV() {
      const url = `https://raw.githubusercontent.com/${CONFIG.GITHUB_USER}/${CONFIG.REPO}/main/kandy_od_traffic.csv`;
      const res = await fetch(url);
      if (!res.ok) return;

      const text = await res.text();
      const rows = text.trim().split("\n").slice(1).reverse();

      const tbody = document.getElementById("dataBody");
      tbody.innerHTML = "";

      rows.forEach(row => {
        const cols = row.split(",");
        const tr = document.createElement("tr");
        tr.innerHTML = cols.map(c => `<td class="p-2 border border-slate-700">${c}</td>`).join("");
        tbody.appendChild(tr);
      });
    }

    document.getElementById("triggerBtn").onclick = triggerWorkflow;
    loadCSV();
  </script>
</body>
</html>
